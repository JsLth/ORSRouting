---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

```{r httptest, include=FALSE}
library(httptest2)
set_redactor(function(x) {
  gsub_response(x, "https\\://api.openrouteservice.org/v2/directions/driving-car/", "api/")
})
start_vignette("README")
```

# ORSRouting

<img src="man/figures/orsrouting_sticker.png" width = "150" align="right" />

<!-- badges: start -->
[![R-CMD-check](https://github.com/JsLth/ORSRouting/actions/workflows/check-standard.yaml/badge.svg)](https://github.com/JsLth/ORSRouting/actions/workflows/check-standard.yaml)
[![Lifecycle: maturing](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://lifecycle.r-lib.org/articles/stages.html#maturing)
[![](https://www.r-pkg.org/badges/version/ORSRouting)](https://cran.r-project.org/package=ORSRouting)

[![Codecov test coverage](https://codecov.io/gh/JsLth/ORSRouting/branch/master/graph/badge.svg)](https://app.codecov.io/gh/JsLth/ORSRouting?branch=master)
<!-- badges: end -->

The purpose of this package is to provide a comprehensive and convenient R interface to local OpenRouteService instances in order to facilitate batch routing. The package functions (so far) enable qualitative and quantitative route computations, distance matrix generation, and accessibility analyses (i.e. isochrones). Also included is a function family to build local customized OpenRouteService instances from scratch. While it is possible to use ORSRouting with the official web API, requests will be very slow due to rate restrictions and therefore not really suitable for larger scale analyses.

## Installation

You can install the development version of ORSRouting from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("JsLth/ORSRouting")
```

## Basic usage

To connect to a running OpenRouteService server - or to build a new one, use the workhorse function `ors_instance`:

```{r instance}
library(ORSRouting)
library(sf)

# API keys are stored in the ORS_TOKEN environment variable
ors <- ors_instance(server = "public")
```

The ORS instance is then attached to the session and is automatically detected by all other functions. To perform a simple routing request, run `ors_inspect`:

```{r inspect}
ors_inspect(pharma[1:2, ], profile = "driving-car", extra_info = "surface")
```


## Local instances

While `ORSRouting` can work with public API requests, it is primarily designed to be used together with local instances. The `ors_instance` family can be used to manage, control and build local ORS instances. The following code would jumpstart an initial instance, add an OSM extract of Rutland, add three routing profiles, set a random port, 100 MB of RAM and finally start the ORS instance. For more details, refer to `vignette("ors-installation")`.

```{r local, eval=FALSE}
ors <- ors_instance(dir = "~")
ors$set_extract("Rutland", provider = "geofabrik")
ors$add_profiles("car", "bike-regular", "walking")
ors$set_port()
ors$set_ram(0.1)
ors$up()
```

